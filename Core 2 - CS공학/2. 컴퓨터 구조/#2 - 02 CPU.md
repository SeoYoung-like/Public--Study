# 08. CPU

**CPU ( Central Processing Unit )**

컴퓨터에서 이루어지는 모든 일에 관여한다. ( 컴퓨터의 두뇌 )



**[ 최초의 CPU ]**

1971년 인텔이 출시한 4비트 CPU이다. 
시장에 출시된 최초의 마이크로프로세서로 알려져 있다.





## **1. CPU의 언어** 

<img src="./assets/8-1.%20CPU%EC%96%B8-1681462229195-3.png" alt="8-1. CPU언" style="zoom:50%;" />



1. **기계어 Machin code** 

   * 2진수로 되어 있는 언어 

   * 초창기 프로그래머들이나 사용했던 언어들이다.

2. **어셈블리어 assembly language**

   * 일관성있는 문법보다 제조사별로 다른 규격과 특징을 지니고 있다.
      ISA에 따라 다 다르기 때문에 어셈블리어의 명령어 역시 통일된 규격이 없다. 또한 문법 아키텍처에 따라서도 다르고 어셈블러의 종류에 따라서도 문법/매크로 등이 제각각이다.
      
   * 명령어의 집합 - ISA ( Instruction Set Architecture(ISA), Instruction Set )
      * 소프트웨어와 하드웨어 사이의 약속이다. 
      
      * (나중에 검증 필요) 나의 개인적 생각 : 명령어 집합이라는 개념은 어셈블리어와 기계어가 둘이서 함께 사용되는 개념으로 이해하면 좋을 듯 하다. 
      
      * ex) Intel, ARM, RISC-V 등이 있다.
      
        <img src="./assets/8-2.%20CPU%20%EB%AA%85%EB%A0%B9%EC%96%B4%20%EC%A7%91%ED%95%A9.png" alt="8-2. CPU 명령어 집합" style="zoom: 67%;" />







## 2. CPU 구성

### 1.1. 구성요소

* 제어장치 ( Control Unit ) : 반복 처리, 흐름 제어

* 산술 논리 장치 ( Arithmetic Logic Unit - ALU )

* **여러가지 레지스터들★ ( Registers )**

  * 워크스테이션을 하는 역할, 작업공간이다. 
    ( 연산이 벌어지는 **임시 저장소** )
    
  * 레지스터와 메모리는 기능적으로는 동일하나 구조적으로는 매우 다르다.

  * **[ 레지스터의 종류 ]**
    다양한 **<u>고유 이름</u>**이 존재한다.
    
    <img src="./assets/8-3.%20CPU%EC%9D%98%20%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C.png" alt="8-3. CPU의 구성요소" style="zoom: 67%;" />
    
    * 주소 레지스터(Address Register) : 읽거나 쓸 **메모리 주소** **저장**한다.
    * 프로그램 카운터 (PC, Program Counter) : **다음에 수행 할** **명령어**의 **메모리 주소** **저장**한다.
    * 데이터 레지스터 (DR, Data Register) : **메모리**에서 읽어온 **데이터 저장**
    * 명령어 레지스터 (IR, Instruction Register) : **메모리**에서 읽어온 **명령어 저장**
    * 어큐뮬레이터 (누산기, accumulator) : 연산에 사용되는 데이터 저장
      * 이 외에도 몇가지 더 존재한다.
      * <u>(참고자료) 초보 프로그래머가 꼭 알아야 할 컴퓨터 동작 원리 / 김종훈 / 한빛미디어</u>

* **캐쉬 메모리** 
  주기억장치 RAM과 CPU간의 속도 차이를 극복하기 위한 공간이다.
  속도가 빠른 장치와 느린 장치에서 속도 차이에 따른 병목 현상을 줄이기 위한 메모리를 말한다.

  ```text
  1) CPU 코어와 메모리 사이의 병목 현상 완화
  2) 웹 브라우저 캐시 파일은, 하드디스크와 웹페이지 사이의 병목 현상을 완화 ???
  ```

  CPU가 주기억장치에서 저장된 데이터를 읽어올 때, 자주 사용하는 데이터를 캐시 메모리에 미리 저장한 뒤, 다음에 이용할 때 주기억장치가 아닌 캐시 메모리에서 먼저 가져오면서 속도를 향상시킨다. ( 여러가지 **예측 알고리즘을 사용해서 캐시의 적중률을 높이려고 한다.** )

  속도라는 장점을 얻지만, 비용이 비싼 점 때문에 적은 용량을 사용한다.

  ---

  CPU에는 이러한 캐시 메모리가 2~3개 정도 사용되고, L1, L2, L3 캐쉬메모리라 불린다.

  ( 속도 : L1 > L2 > L3 / L1으로 갈수록 CPU와 가깝고, L3로 갈 수록 메모리와 가까워진다. )

  <img src="./assets/8-6.%20CPU%EC%99%80%20%EB%A9%94%EB%AA%A8%EB%A6%AC%20-%20%EC%BA%90%EC%89%AC%EB%A9%94%EB%AA%A8%EB%A6%AC.png" alt="8-6. CPU와 메모리 - 캐쉬메모리" style="zoom:67%;" />

### 1.2. 성능 지표

#### 1) 코어

CPU에서 가장 핵심이 되는 부품이다.

코어의 속도를 높여 가는 방식에서 여러 개의 코어를 한 번에 탑재하는 멀티 코어 방식을 택하게 된다.

예를들어, 식당으로 치면 직원이 여러 명이라고 생각하면 된다.

> ---
>
> [ 멀티 코어 ]
>
> 멀티 코어 환경을 잘 활용하려면 프로그램도 이를 고려해서 여러 개의 코어를 사용할 수 있도록 프로그래밍 해야 한다.
>
> ---



#### 2) 스레드

CPU의 여유 자원으로 가상의 코어를 추가해서 일을 시키는 것이다.

CPU에서 말하는 스레드는 하나의 코어가 N개의 코어로 효율를을낼 수 있도록 만드는 기술이라 할 수 있다.
예를들어, 식당에서 직원 1명이 2명분의 일을 하는 것처럼 보인다.

2코어 4스레드 사양의 CPU를 장착한 컴퓨터의 정보를 열어보면 4코어가 설치되어 있다고 인식한다.

[참고] 소프트웨어 상의 스레드와 CPU의 스레드는 다르다.



#### 3) 클럭

기가헤르트(GHz) 단위로 표시되는 코어 속도를 말한다.
코어의 속도는 숫자가 클수록 빠르다. 

CPU의 속도는 전반적으로 클럭 속도와 코어의 개수, 스레드의 개수로 결정된다.

* Hz : 1초에 몇 번 진동하는 개념

* 클럭
  * 하나의 사이클
  * 기억을 꺼냄 => 계산 => 기억을 넣음



**[ 나중에 더 알아야 할 개념 ] L3 캐시 메모리 / 64비트 연산 체계**







## 3. CPU와 프로그램

### 3.1. CPU에서 프로그램이 진행되는 과정

메모리에 **'주소'**와 **'데이터'**는 따로 저장되어 있으면 명령에 따라 진행된다. 
( 참고로, 메모리 저장 방식에는 여러 형태가 있다. )

<img src="./assets/8-4%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%EC%9D%B4%20%EC%8B%9C%EC%9E%91%EB%90%98%EB%8A%94%20%EA%B3%BC%EC%A0%951.png" alt="8-4 프로그래밍이 시작되는 과정1" style="zoom: 67%;" />

<img src="./assets/8-5%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%EC%9D%B4%20%EC%B2%98%EB%A6%AC%EB%90%98%EB%8A%94%20%EA%B3%BC%EC%A0%952.png" alt="8-5 프로그래밍이 처리되는 과정2" style="zoom:67%;" />



**[참고 동영상]** https://youtu.be/rTaNNQhwmt0









### 3.2. CPU가 하는 일

**아래 4가지의 일을 반복한다.**
( 메모리와 함께 작업 - 중간에 캐시메모리가 관여하여 병목현상을 해소한다. )

* 인출 > 해석 > 실행 > 쓰기

* Fetch ( 인출 )
  * 메모리(Memory)상의 <u>프로그램 카운터</u>가 가리키는 명령어를 CPU로 **인출**하여 **적재**시킨다.
* Decode ( 해석 )
  * 명령어의 해석, 이 단계에서 명령어의 종류와 타겟 등을 **판단**한다.
* Execute ( 실행 )
  * 해석된 명령어에 따라 데이터에 대한 연산을 **수행**한다.
* Writeback ( 쓰기 )
  * 명령어대로 처리 완료된 데이터를 메모리(Memory)에 **기록**한다.

---

**[ 기타 기능 ]**

* 멀티태스킹 : 1코어는 한 시점에 1가지 일만 한다. 
                                          아주 빠르게 처리하고 **스위칭**하기 때문에 그렇게 보이는 것 뿐이다. 

  ​					   ex) JUMP - 프로그램 카운터 변화 시키는 명령어다.

* 인터럽트 : 사용자 키보드, 마우스 등의 입력이 왔을 때 잠시 멈추고, 그것을 먼저 처리해주는 기능이 있다.







## 4. CPU 발전 과정

※ 나중에 추가로 배워서 채울 예정이다.

* 멀티프로세싱
  * 전기 소모
  * 발열 증가
  * 결국 이 방식도 효율성의 한계를 가지고 있다.







---



### [참고] CPU 만들기

http://www.homebrewcpu.com/

- 널널한 개발자 추천 과제
